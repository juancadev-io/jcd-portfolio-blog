---
import type { CollectionEntry } from "astro:content";
import FormattedDate from "../components/FormattedDate.astro";
import Layout from "./Layout.astro";

type Props = CollectionEntry<"blog">["data"] & {
  readingTime?: number;
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  lang,
  author,
  readingTime,
} =
  Astro.props;

import { useTranslations, type UiType } from "../i18n/utils";

const t = useTranslations(lang as UiType);

const hasPubDate = Boolean(pubDate);
const hasUpdatedDate = Boolean(updatedDate);
const displayDate = hasPubDate && hasUpdatedDate
  ? (updatedDate > pubDate ? updatedDate : pubDate)
  : (updatedDate ?? pubDate);
const displayDateLabel = hasUpdatedDate && (!hasPubDate || updatedDate > pubDate)
  ? t("updated.on")
  : "Publicado";
---

<Layout
  title={title}
  description={description}
  heroImage={heroImage}
  pubDate={pubDate}
  updatedDate={updatedDate}
  lang={lang}
>
  <article class="prose prose-sm sm:prose-base lg:prose-lg prose-invert max-w-none">
    <!-- Hero Image -->
    {heroImage && (
      <div class="mb-8 rounded-lg overflow-hidden shadow-lg">
        <img width={1020} height={510} src={heroImage} alt={title} class="w-full h-auto" />
      </div>
    )}
    
    <!-- Meta Info -->
    <div class="mb-8 pb-6 gradient-border-bottom">
      <h1 class="text-3xl sm:text-4xl font-bold mb-4 gradient-text">
        {title}
      </h1>
      <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 text-sm text-gray-400">
        {displayDate && (
          <div class="flex items-center gap-1">
            <span class="font-medium">{displayDateLabel}:</span>
            <FormattedDate date={displayDate} />
          </div>
        )}
        {readingTime && (
          <div class="flex items-center gap-1">
            <span class="font-medium">{t("reading.time")}:</span>
            <span>{readingTime} min</span>
          </div>
        )}
        by <div class="font-medium">{author}</div>
      </div>
    </div>
    
    <!-- Content -->
    <div class="blog-content">
      <slot />
    </div>
  </article>
</Layout>

<style>
  .blog-content :global(a) {
    color: var(--color-primary);
    text-decoration: underline;
    transition: color 0.2s ease;
  }
  
  .blog-content :global(a:hover) {
    color: var(--color-secondary);
  }
  
  .blog-content :global(code) {
    background-color: var(--color-surface-elevated);
    padding: 0.125rem 0.25rem;
    border-radius: var(--radius-base);
    font-size: 0.875em;
  }
  
  .blog-content :global(pre) {
    background-color: var(--color-surface-elevated);
    padding: 1rem;
    border-radius: var(--radius-lg);
    overflow-x: auto;
    border-left: 3px solid var(--color-primary);
  }
  
  .blog-content :global(blockquote) {
    border-left: 4px solid;
    border-image: linear-gradient(180deg, var(--color-primary), var(--color-secondary)) 1;
    padding-left: 1rem;
    font-style: italic;
    color: var(--color-text-secondary);
  }
</style>
